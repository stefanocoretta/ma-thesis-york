---
title: "Linear mixed effect model"
author: "Stefano Coretta"
date: "22/02/2017"
output: pdf_document
---

```{r setup, include=FALSE}
opts_knit$set(root.dir=normalizePath('../'))
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyr)
library(lme4)
library(effects)
library(afex)
library(knitr)
library(ggplot2)
library(car)
```

```{r data}
words <- read_csv("task/task-src/words.csv")

icelandic <- read_csv("results/results.csv", na = "--undefined--") %>%
    left_join(y = words) %>%
    mutate_if(is.character, as.factor)
```

```{r lmer}
model1 <- lmer(dur_vowel ~ aspiration + vor + (1|speaker) + (1|word),
              data = icelandic
              )

summary(model1)
plot(allEffects(model1))
```

```{r mixed-all}
mixed(dur_vowel ~ aspiration + place + manner + syllables + vowel +
                  cons1 + vor + (1|speaker) + (1|word),
              data = icelandic)
```


```{r }
model2 <- lmer(dur_voic ~ aspiration + place + manner + syllables + vowel +
                  cons1 + vor + (1|speaker) + (1|word),
              data = icelandic
              )

summary(model2)
plot(allEffects(model2))
```

## Stops

```{r stops}
icelandic.stops <- filter(icelandic, manner == "stop")
```

```{r lmer-stops-word}
model.stops.words <-  lmer(dur_word ~ aspiration + syllables +
                              (1 + aspiration|speaker) + (1|word),
                     data = icelandic.stops, REML = FALSE
                     )

summary(model.stops.words)
plot(allEffects(model.stops.words))
```


```{r lmer-stops-vor}
model.stops.vor <-  lmer(vor ~ aspiration + syllables +
                              (1 + aspiration|speaker) + (1|word),
                     data = icelandic.stops, REML = FALSE
                     )

summary(model.stops.vor)
plot(allEffects(model.stops.vor))
```

```{r lmer-geminate}
model.geminate <-  lmer(dur_vowel ~ dur_geminate + dur_word + aspiration +
                         (1|speaker) + (1|word),
                     data = icelandic.stops, REML = FALSE
                     )

summary(model.geminate)
plot(allEffects(model.geminate))

model.vowels.geminates <- lm(cbind(dur_vowel, dur_geminate) ~ dur_word,
                             data = icelandic.stops
                             )

summary(Anova(model.vowels.geminates))
```

```{r lmer-geminate-duration}
model.geminate.duration <-  lmer(dur_geminate ~ aspiration + vor +
                         (1|speaker) + (1|word),
                     data = icelandic.stops, REML = FALSE
                     )

summary(model.geminate.duration)
plot(allEffects(model.geminate.duration))
```


```{r lmer-stops}
model.stops <-  lmer(dur_vowel ~ aspiration + vor +
                         (1 + aspiration|speaker) + (1|word),
                     data = icelandic.stops, REML = FALSE
                     )

summary(model.stops)
plot(allEffects(model.stops))
```

```{r mixed-stops}
mixed(dur_vowel ~ aspiration + vor + (1 + aspiration|speaker) + (1|word),
              data = icelandic.stops)
```

```{r likelihood-stops}
model.stops.null <- lmer(dur_vowel + vor ~ (1|speaker) + (1|word),
              data = icelandic.stops, REML = FALSE)

anova(model.stops.null, model.stops)
```

# Nasals

```{r nasals}
icelandic.nasals <- filter(icelandic, manner == "nasal") %>%
    droplevels()
```

```{r lmer-nasals-vor}
model.nasals.vor <-  lmer(vor ~ aspiration + syllables +
                              (1 + aspiration|speaker) + (1|word),
                     data = icelandic.nasals, REML = FALSE
                     )

summary(model.nasals.vor)
plot(allEffects(model.nasals.vor))
```

```{r lmer-nasals-closure}
model.nasals.closure <-  lmer(dur_clos ~ aspiration + syllables +
                              (1 + aspiration|speaker) + (1|word),
                     data = icelandic.nasals, REML = FALSE
                     )

summary(model.nasals.closure)
plot(allEffects(model.nasals.closure))
```

```{r plot-nasals-vowels}
ggplot(icelandic.nasals, aes(dur_vowel, dur_mann, colour = syllables)) +
    facet_grid(. ~ speaker) +
    geom_point()
```

```{r lmer-nasals-vowels}
model.vowels.nasals <- lmer(dur_vowel ~ dur_mann + vor + syllables +
                          (1|speaker) +
                          (1|word),
                     data = icelandic.nasals, REML = FALSE
                     )

summary(model.vowels.nasals)

plot(allEffects(model.vowels.nasals))
```

```{r lmer-nasals}
model.nasals <-  lmer(dur_vowel ~ aspiration + vor + syllables +
                          (1 + aspiration|speaker) +
                          (1|word),
                     data = icelandic.nasals, REML = FALSE
                     )

summary(model.nasals)
plot(allEffects(model.nasals))
```
